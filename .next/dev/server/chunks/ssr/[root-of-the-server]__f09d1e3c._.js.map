{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///home/hembi/Desktop/sop-builder-mvp/lib/types.ts"],"sourcesContent":["// =============================================================================\n// STEPWISE - TYPE DEFINITIONS\n// Core types for the SOP Builder application\n// =============================================================================\n\nimport { z } from \"zod\"\n\n// -----------------------------------------------------------------------------\n// Note Categories - 12 categories as specified in aisop.md\n// -----------------------------------------------------------------------------\n\nexport const NOTE_CATEGORIES = {\n    HEADER_INFO: 'HEADER_INFO',\n    PURPOSE_SCOPE: 'PURPOSE_SCOPE',\n    ROLES_RESPONSIBILITIES: 'ROLES_RESPONSIBILITIES',\n    PROCEDURE_STEPS: 'PROCEDURE_STEPS',\n    DECISION_POINTS: 'DECISION_POINTS',\n    QUALITY_SUCCESS: 'QUALITY_SUCCESS',\n    TROUBLESHOOTING: 'TROUBLESHOOTING',\n    DEFINITIONS_REFERENCES: 'DEFINITIONS_REFERENCES',\n    MATERIALS_RESOURCES: 'MATERIALS_RESOURCES',\n    VISUAL_AIDS: 'VISUAL_AIDS',\n    GAPS_IMPROVEMENTS: 'GAPS_IMPROVEMENTS',\n    METADATA: 'METADATA',\n    OTHER: 'OTHER',\n} as const\n\nexport type NoteCategory = keyof typeof NOTE_CATEGORIES\n\nexport const noteCategorySchema = z.enum([\n    'HEADER_INFO',\n    'PURPOSE_SCOPE',\n    'ROLES_RESPONSIBILITIES',\n    'PROCEDURE_STEPS',\n    'DECISION_POINTS',\n    'QUALITY_SUCCESS',\n    'TROUBLESHOOTING',\n    'DEFINITIONS_REFERENCES',\n    'MATERIALS_RESOURCES',\n    'VISUAL_AIDS',\n    'GAPS_IMPROVEMENTS',\n    'METADATA',\n    'OTHER',\n])\n\nexport const conversationPhaseSchema = z.enum([\n    'foundation',\n    'process',\n    'accountability',\n    'quality',\n    'finalization',\n    'complete',\n])\n\nexport const aiResponseNoteSchema = z.object({\n    category: z.string(),\n    priority: z.enum(['high', 'medium', 'low']),\n    content: z.string(),\n    relatedTo: z.string(),\n    action: z.string(),\n})\n\nexport const aiResponseSchema = z.object({\n    message: z.string(),\n    notes: z.array(aiResponseNoteSchema),\n    phase: conversationPhaseSchema,\n    progress: z.number().min(0).max(100),\n})\n\n// -----------------------------------------------------------------------------\n// Conversation Phases - 5-phase system from aisop.md\n// -----------------------------------------------------------------------------\n\nexport const CONVERSATION_PHASES = {\n    foundation: {\n        name: 'Foundation',\n        description: 'Basic information gathering',\n        targetQuestions: 7,\n        order: 1,\n    },\n    process: {\n        name: 'Process Discovery',\n        description: 'Mapping step-by-step procedures',\n        targetQuestions: 15,\n        order: 2,\n    },\n    accountability: {\n        name: 'Accountability',\n        description: 'Roles and responsibilities',\n        targetQuestions: 8,\n        order: 3,\n    },\n    quality: {\n        name: 'Risk & Quality',\n        description: 'Error handling and metrics',\n        targetQuestions: 8,\n        order: 4,\n    },\n    finalization: {\n        name: 'Finalization',\n        description: 'Final details and review',\n        targetQuestions: 5,\n        order: 5,\n    },\n    complete: {\n        name: 'Complete',\n        description: 'Ready for generation',\n        targetQuestions: 0,\n        order: 6,\n    },\n} as const\n\nexport type ConversationPhase = keyof typeof CONVERSATION_PHASES\n\n// -----------------------------------------------------------------------------\n// Note Interface - Enhanced to match aisop.md specification\n// -----------------------------------------------------------------------------\n\nexport interface Note {\n    id: string\n    category: NoteCategory\n    priority: 'high' | 'medium' | 'low'\n    timestamp: string\n    source: 'User Response' | 'AI Extraction' | 'AI Suggestion' | 'Manual'\n    content: string\n    relatedTo: string // Which SOP section this maps to\n    action: string // What to do with this info when generating SOP\n}\n\n// -----------------------------------------------------------------------------\n// AI Response Structure - JSON format from aisop.md\n// -----------------------------------------------------------------------------\n\nexport interface AIResponseNote {\n    category: string\n    priority: 'high' | 'medium' | 'low'\n    content: string\n    relatedTo: string\n    action: string\n}\n\nexport interface AIResponse {\n    message: string\n    notes: AIResponseNote[]\n    phase: ConversationPhase\n    progress: number // 0-100\n}\n\n// -----------------------------------------------------------------------------\n// Chat Message Types\n// -----------------------------------------------------------------------------\n\nexport interface ChatMessage {\n    id: string\n    role: 'ai' | 'user'\n    content: string\n    timestamp: string\n}\n\n// -----------------------------------------------------------------------------\n// SOP Document Types\n// -----------------------------------------------------------------------------\n\nexport interface SOP {\n    id: string\n    title: string\n    department?: string\n    status: 'draft' | 'complete' | 'archived'\n    createdAt: string\n    updatedAt: string\n    content: string\n    notes: Note[]\n    chatHistory: ChatMessage[]\n}\n\n// -----------------------------------------------------------------------------\n// Session State - For active SOP creation sessions\n// -----------------------------------------------------------------------------\n\nexport interface SessionState {\n    id: string\n    title: string\n    messages: ChatMessage[]\n    notes: Note[]\n    phase: ConversationPhase\n    phaseProgress: number\n    questionsAsked: number\n    createdAt: string\n    metadata?: Record<string, any>\n}\n\n// -----------------------------------------------------------------------------\n// Category Styling - For UI display\n// -----------------------------------------------------------------------------\n\nexport interface CategoryStyle {\n    bg: string\n    text: string\n    label: string\n    icon?: string\n}\n\nexport const CATEGORY_STYLES: Record<NoteCategory, CategoryStyle> = {\n    HEADER_INFO: { bg: 'bg-blue-100', text: 'text-blue-700', label: 'Header Info' },\n    PURPOSE_SCOPE: { bg: 'bg-purple-100', text: 'text-purple-700', label: 'Purpose & Scope' },\n    ROLES_RESPONSIBILITIES: { bg: 'bg-green-100', text: 'text-green-700', label: 'Roles' },\n    PROCEDURE_STEPS: { bg: 'bg-orange-100', text: 'text-orange-700', label: 'Procedure' },\n    DECISION_POINTS: { bg: 'bg-amber-100', text: 'text-amber-700', label: 'Decision Points' },\n    QUALITY_SUCCESS: { bg: 'bg-teal-100', text: 'text-teal-700', label: 'Quality' },\n    TROUBLESHOOTING: { bg: 'bg-red-100', text: 'text-red-700', label: 'Troubleshooting' },\n    DEFINITIONS_REFERENCES: { bg: 'bg-indigo-100', text: 'text-indigo-700', label: 'Definitions' },\n    MATERIALS_RESOURCES: { bg: 'bg-cyan-100', text: 'text-cyan-700', label: 'Materials' },\n    VISUAL_AIDS: { bg: 'bg-pink-100', text: 'text-pink-700', label: 'Visual Aids' },\n    GAPS_IMPROVEMENTS: { bg: 'bg-yellow-100', text: 'text-yellow-700', label: 'Gaps' },\n    METADATA: { bg: 'bg-slate-100', text: 'text-slate-700', label: 'Metadata' },\n    OTHER: { bg: 'bg-gray-100', text: 'text-gray-700', label: 'Other' },\n}\n\n// -----------------------------------------------------------------------------\n// Priority Styling\n// -----------------------------------------------------------------------------\n\nexport const PRIORITY_STYLES = {\n    high: { color: 'text-red-500', icon: '!!' },\n    medium: { color: 'text-amber-500', icon: '!' },\n    low: { color: 'text-green-500', icon: 'Â·' },\n} as const\n\n// -----------------------------------------------------------------------------\n// Helper Functions\n// -----------------------------------------------------------------------------\n\n/**\n * Validates if a string is a valid NoteCategory\n */\nexport function isValidNoteCategory(category: string): category is NoteCategory {\n    return category in NOTE_CATEGORIES\n}\n\n/**\n * Validates if a string is a valid ConversationPhase\n */\nexport function isValidPhase(phase: string): phase is ConversationPhase {\n    return phase in CONVERSATION_PHASES\n}\n\n/**\n * Get the next phase in the conversation flow\n */\nexport function getNextPhase(currentPhase: ConversationPhase): ConversationPhase {\n    const phases: ConversationPhase[] = ['foundation', 'process', 'accountability', 'quality', 'finalization', 'complete']\n    const currentIndex = phases.indexOf(currentPhase)\n    if (currentIndex < phases.length - 1) {\n        return phases[currentIndex + 1]\n    }\n    return 'complete'\n}\n\n/**\n * Calculate overall progress based on phase and phase progress\n */\nexport function calculateOverallProgress(phase: ConversationPhase, phaseProgress: number): number {\n    const phaseWeights: Record<ConversationPhase, { start: number; weight: number }> = {\n        foundation: { start: 0, weight: 15 },\n        process: { start: 15, weight: 35 },\n        accountability: { start: 50, weight: 15 },\n        quality: { start: 65, weight: 20 },\n        finalization: { start: 85, weight: 15 },\n        complete: { start: 100, weight: 0 },\n    }\n\n    const { start, weight } = phaseWeights[phase]\n    return Math.min(100, start + (phaseProgress / 100) * weight)\n}\n\n/**\n * Generate a unique ID\n */\nexport function generateId(prefix: string = 'id'): string {\n    return `${prefix}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 294, "column": 0}, "map": {"version":3,"sources":["file:///home/hembi/Desktop/sop-builder-mvp/lib/sop-context.tsx"],"sourcesContent":["\"use client\"\n\n// =============================================================================\n// STEPWISE - SOP CONTEXT PROVIDER\n// Global state management for SOP creation with 5-phase conversation flow\n// =============================================================================\n\nimport { createContext, useContext, useState, useCallback, type ReactNode } from \"react\"\nimport {\n  type Note,\n  type ChatMessage,\n  type SOP,\n  type SessionState,\n  type ConversationPhase,\n  generateId,\n  getNextPhase,\n  calculateOverallProgress,\n} from \"./types\"\nimport type { AnalysisResult } from \"./sop-analyzer\"\n\n// -----------------------------------------------------------------------------\n// Mock Data for Initial State\n// -----------------------------------------------------------------------------\n\nconst MOCK_SOPS: SOP[] = [\n  {\n    id: \"sop-001\",\n    title: \"Invoice Approval Procedure v2.0\",\n    department: \"Finance\",\n    status: \"complete\",\n    createdAt: \"2025-12-18T10:00:00Z\",\n    updatedAt: \"2025-12-20T08:30:00Z\",\n    content: `# Invoice Approval Procedure v2.0\\n\\n**Document ID:** SOP-FIN-001\\n**Version:** 2.0\\n**Effective Date:** December 20, 2025\\n\\n## 1. PURPOSE\\nThis SOP establishes standardized procedures for invoice approval.\\n\\n## 2. SCOPE\\nApplies to Accounts Payable team and all department managers.\\n\\n## 3. PROCEDURE\\n1. Receive invoice\\n2. Verify details\\n3. Route for approval\\n4. Process payment`,\n    notes: [],\n    chatHistory: [],\n  },\n  {\n    id: \"sop-002\",\n    title: \"Employee Onboarding Process\",\n    department: \"HR\",\n    status: \"draft\",\n    createdAt: \"2025-12-19T14:00:00Z\",\n    updatedAt: \"2025-12-19T16:45:00Z\",\n    content: \"# Employee Onboarding Process\\n\\n*Draft in progress...*\",\n    notes: [],\n    chatHistory: [],\n  },\n]\n\n// -----------------------------------------------------------------------------\n// Context Types\n// -----------------------------------------------------------------------------\n\ninterface SOPContextType {\n  // SOP Library\n  sops: SOP[]\n  currentSOP: SOP | null\n  setCurrentSOP: (sop: SOP | null) => void\n  addSOP: (sop: SOP) => void\n  updateSOP: (id: string, updates: Partial<SOP>) => void\n  deleteSOP: (id: string) => void\n\n  // Note Management\n  addNote: (sopId: string, note: Note) => void\n  updateNote: (sopId: string, noteId: string, updates: Partial<Note>) => void\n  deleteNote: (sopId: string, noteId: string) => void\n\n  // Message Management\n  addMessage: (sopId: string, message: ChatMessage) => void\n\n  // Session Management (for active creation)\n  session: SessionState | null\n  startNewSession: () => string\n  startImprovementSession: (content: string, analysis: AnalysisResult) => string\n  updateSession: (updates: Partial<SessionState>) => void\n  endSession: () => void\n\n  // Session Notes\n  addSessionNote: (note: Note) => void\n  addSessionNotes: (notes: Note[]) => void\n  updateSessionNote: (noteId: string, updates: Partial<Note>) => void\n  deleteSessionNote: (noteId: string) => void\n\n  // Session Messages\n  addSessionMessage: (message: ChatMessage) => void\n\n  // Phase Management\n  setSessionPhase: (phase: ConversationPhase, progress?: number) => void\n  advancePhase: () => void\n\n  // Finalization\n  finalizeSession: (title?: string, department?: string) => SOP | null\n\n  // Utilities\n  getSessionNotesByCategory: () => Record<string, Note[]>\n  getSessionProgress: () => number\n}\n\nconst SOPContext = createContext<SOPContextType | undefined>(undefined)\n\n// -----------------------------------------------------------------------------\n// Provider Component\n// -----------------------------------------------------------------------------\n\nexport function SOPProvider({ children }: { children: ReactNode }) {\n  // SOP Library State\n  const [sops, setSops] = useState<SOP[]>(MOCK_SOPS)\n  const [currentSOP, setCurrentSOP] = useState<SOP | null>(null)\n\n  // Active Session State\n  const [session, setSession] = useState<SessionState | null>(null)\n\n  // -------------------------------------------------------------------------\n  // SOP CRUD Operations\n  // -------------------------------------------------------------------------\n\n  const addSOP = useCallback((sop: SOP) => {\n    setSops((prev) => [...prev, sop])\n  }, [])\n\n  const updateSOP = useCallback((id: string, updates: Partial<SOP>) => {\n    setSops((prev) =>\n      prev.map((sop) =>\n        sop.id === id\n          ? { ...sop, ...updates, updatedAt: new Date().toISOString() }\n          : sop\n      )\n    )\n\n    // Update currentSOP if it's the one being modified\n    if (currentSOP?.id === id) {\n      setCurrentSOP((prev) => (prev ? { ...prev, ...updates } : null))\n    }\n  }, [currentSOP?.id])\n\n  const deleteSOP = useCallback((id: string) => {\n    setSops((prev) => prev.filter((sop) => sop.id !== id))\n    if (currentSOP?.id === id) {\n      setCurrentSOP(null)\n    }\n  }, [currentSOP?.id])\n\n  // -------------------------------------------------------------------------\n  // Note Operations (for saved SOPs)\n  // -------------------------------------------------------------------------\n\n  const addNote = useCallback((sopId: string, note: Note) => {\n    setSops((prev) =>\n      prev.map((sop) =>\n        sop.id === sopId\n          ? { ...sop, notes: [...sop.notes, note], updatedAt: new Date().toISOString() }\n          : sop\n      )\n    )\n  }, [])\n\n  const updateNote = useCallback((sopId: string, noteId: string, updates: Partial<Note>) => {\n    setSops((prev) =>\n      prev.map((sop) =>\n        sop.id === sopId\n          ? {\n            ...sop,\n            notes: sop.notes.map((n) => (n.id === noteId ? { ...n, ...updates } : n)),\n            updatedAt: new Date().toISOString(),\n          }\n          : sop\n      )\n    )\n  }, [])\n\n  const deleteNote = useCallback((sopId: string, noteId: string) => {\n    setSops((prev) =>\n      prev.map((sop) =>\n        sop.id === sopId\n          ? {\n            ...sop,\n            notes: sop.notes.filter((n) => n.id !== noteId),\n            updatedAt: new Date().toISOString(),\n          }\n          : sop\n      )\n    )\n  }, [])\n\n  // -------------------------------------------------------------------------\n  // Message Operations (for saved SOPs)\n  // -------------------------------------------------------------------------\n\n  const addMessage = useCallback((sopId: string, message: ChatMessage) => {\n    setSops((prev) =>\n      prev.map((sop) =>\n        sop.id === sopId\n          ? { ...sop, chatHistory: [...sop.chatHistory, message] }\n          : sop\n      )\n    )\n  }, [])\n\n  // -------------------------------------------------------------------------\n  // Session Management\n  // -------------------------------------------------------------------------\n\n  const startNewSession = useCallback((): string => {\n    const newId = generateId(\"session\")\n    const newSession: SessionState = {\n      id: newId,\n      title: \"New SOP\",\n      messages: [],\n      notes: [],\n      phase: \"foundation\",\n      phaseProgress: 0,\n      questionsAsked: 0,\n      createdAt: new Date().toISOString(),\n    }\n    setSession(newSession)\n    return newId\n  }, [])\n\n  const startImprovementSession = useCallback((content: string, analysis: AnalysisResult): string => {\n    const newId = generateId(\"session\")\n\n    // Create initial notes from analysis improvements\n    const improvementNotes: Note[] = analysis.improvements.map(imp => ({\n      id: generateId(\"note\"),\n      category: \"GAPS_IMPROVEMENTS\",\n      priority: imp.priority.toLowerCase() as \"high\" | \"medium\" | \"low\",\n      content: `${imp.description} - Suggestion: ${imp.suggestion}`,\n      timestamp: new Date().toISOString(),\n      source: \"AI Extraction\",\n      relatedTo: imp.category,\n      action: \"Needs addressing\",\n    }))\n\n    const newSession: SessionState = {\n      id: newId,\n      title: \"SOP Improvement\",\n      messages: [], // Start with empty messages - AI greeting will be shown separately\n      notes: improvementNotes,\n      phase: \"foundation\", // Start at foundation to re-verify basics\n      phaseProgress: 0,\n      questionsAsked: 0,\n      createdAt: new Date().toISOString(),\n      metadata: {\n        mode: \"improve\",\n        originalContent: content, // Store original SOP for AI context\n        analysisResult: analysis\n      }\n    }\n\n    setSession(newSession)\n    return newId\n  }, [])\n\n  const updateSession = useCallback((updates: Partial<SessionState>) => {\n    setSession((prev) => (prev ? { ...prev, ...updates } : null))\n  }, [])\n\n  const endSession = useCallback(() => {\n    setSession(null)\n  }, [])\n\n  // -------------------------------------------------------------------------\n  // Session Note Operations\n  // -------------------------------------------------------------------------\n\n  const addSessionNote = useCallback((note: Note) => {\n    setSession((prev) =>\n      prev ? { ...prev, notes: [...prev.notes, note] } : null\n    )\n  }, [])\n\n  const addSessionNotes = useCallback((notes: Note[]) => {\n    if (notes.length === 0) return\n    setSession((prev) =>\n      prev ? { ...prev, notes: [...prev.notes, ...notes] } : null\n    )\n  }, [])\n\n  const updateSessionNote = useCallback((noteId: string, updates: Partial<Note>) => {\n    setSession((prev) =>\n      prev\n        ? {\n          ...prev,\n          notes: prev.notes.map((n) =>\n            n.id === noteId ? { ...n, ...updates } : n\n          ),\n        }\n        : null\n    )\n  }, [])\n\n  const deleteSessionNote = useCallback((noteId: string) => {\n    setSession((prev) =>\n      prev\n        ? { ...prev, notes: prev.notes.filter((n) => n.id !== noteId) }\n        : null\n    )\n  }, [])\n\n  // -------------------------------------------------------------------------\n  // Session Message Operations\n  // -------------------------------------------------------------------------\n\n  const addSessionMessage = useCallback((message: ChatMessage) => {\n    setSession((prev) =>\n      prev\n        ? {\n          ...prev,\n          messages: [...prev.messages, message],\n          questionsAsked: message.role === \"ai\" ? prev.questionsAsked + 1 : prev.questionsAsked,\n        }\n        : null\n    )\n  }, [])\n\n  // -------------------------------------------------------------------------\n  // Phase Management\n  // -------------------------------------------------------------------------\n\n  const setSessionPhase = useCallback((phase: ConversationPhase, progress?: number) => {\n    setSession((prev) =>\n      prev\n        ? {\n          ...prev,\n          phase,\n          phaseProgress: progress !== undefined ? progress : prev.phaseProgress,\n        }\n        : null\n    )\n  }, [])\n\n  const advancePhase = useCallback(() => {\n    setSession((prev) => {\n      if (!prev) return null\n      const nextPhase = getNextPhase(prev.phase)\n      return {\n        ...prev,\n        phase: nextPhase,\n        phaseProgress: 0,\n      }\n    })\n  }, [])\n\n  // -------------------------------------------------------------------------\n  // Session Finalization\n  // -------------------------------------------------------------------------\n\n  const finalizeSession = useCallback((title?: string, department?: string): SOP | null => {\n    if (!session) return null\n\n    const newSOP: SOP = {\n      id: session.id.replace(\"session\", \"sop\"),\n      title: title || session.title || \"Untitled SOP\",\n      department: department || \"General\",\n      status: \"draft\",\n      createdAt: session.createdAt,\n      updatedAt: new Date().toISOString(),\n      notes: session.notes,\n      chatHistory: session.messages,\n      content: \"\",\n    }\n\n    addSOP(newSOP)\n    setCurrentSOP(newSOP)\n    setSession(null) // End the session\n\n    return newSOP\n  }, [session, addSOP])\n\n  // -------------------------------------------------------------------------\n  // Utility Functions\n  // -------------------------------------------------------------------------\n\n  const getSessionNotesByCategory = useCallback((): Record<string, Note[]> => {\n    if (!session) return {}\n\n    return session.notes.reduce((acc, note) => {\n      if (!acc[note.category]) {\n        acc[note.category] = []\n      }\n      acc[note.category].push(note)\n      return acc\n    }, {} as Record<string, Note[]>)\n  }, [session])\n\n  const getSessionProgress = useCallback((): number => {\n    if (!session) return 0\n    return calculateOverallProgress(session.phase, session.phaseProgress)\n  }, [session])\n\n  // -------------------------------------------------------------------------\n  // Context Value\n  // -------------------------------------------------------------------------\n\n  const contextValue: SOPContextType = {\n    // SOP Library\n    sops,\n    currentSOP,\n    setCurrentSOP,\n    addSOP,\n    updateSOP,\n    deleteSOP,\n\n    // Note Management\n    addNote,\n    updateNote,\n    deleteNote,\n\n    // Message Management\n    addMessage,\n\n    // Session Management\n    session,\n    startNewSession,\n    startImprovementSession,\n    updateSession,\n    endSession,\n\n    // Session Notes\n    addSessionNote,\n    addSessionNotes,\n    updateSessionNote,\n    deleteSessionNote,\n\n    // Session Messages\n    addSessionMessage,\n\n    // Phase Management\n    setSessionPhase,\n    advancePhase,\n\n    // Finalization\n    finalizeSession,\n\n    // Utilities\n    getSessionNotesByCategory,\n    getSessionProgress,\n  }\n\n  return (\n    <SOPContext.Provider value={contextValue}>\n      {children}\n    </SOPContext.Provider>\n  )\n}\n\n// -----------------------------------------------------------------------------\n// Hook\n// -----------------------------------------------------------------------------\n\nexport function useSOPContext() {\n  const context = useContext(SOPContext)\n  if (!context) {\n    throw new Error(\"useSOPContext must be used within a SOPProvider\")\n  }\n  return context\n}\n"],"names":[],"mappings":"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"}}]
}